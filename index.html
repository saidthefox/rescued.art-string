<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Date+Amount → 8‑char ID (Reversible)</title>
  <style>
    :root { --gap: 14px; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0 auto; padding: 24px; max-width: 760px; line-height: 1.5; }
    h1 { font-size: 1.35rem; margin: 0 0 6px 0; }
    p.note { color: #555; margin-top: 4px; }
    label { font-weight: 600; display:block; margin-top: var(--gap); }
    input, textarea, button { width: 100%; padding: 10px 12px; font-size: 1rem; border: 1px solid #ccc; border-radius: 8px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    .btn { margin-top: var(--gap); background: #0a7; border: 1px solid #0a7; color: white; cursor: pointer; }
    .btn.secondary { background: #555; border-color:#555; }
    .box { padding: 14px; border: 1px dashed #ccc; border-radius: 10px; background: #fafafa; }
    code, .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .muted { color:#666; font-size: .95rem; }
    footer { margin-top: 26px; color:#666; font-size: .85rem; }
    .ok { color: #0a7; font-weight: 600; }
    .err { color: #b00; font-weight: 600; }
  </style>
</head>
<body>
  <h1>Reversible 8‑character ID for Date + Amount</h1>
  <p class="note">Packs <span class="mono">YYYYMMDD</span> and amount (dollars.cents) into <strong>6 bytes</strong>, then encodes as <strong>8‑char</strong> base64url token. No server. No encryption. 100% reversible.</p>

  <div class="box">
    <div class="row">
      <div>
        <label for="date">Date (YYYYMMDD)</label>
        <input id="date" placeholder="20250930" inputmode="numeric" maxlength="8" />
      </div>
      <div>
        <label for="amt">Amount (dollars.cents)</label>
        <input id="amt" placeholder="12.50" inputmode="decimal" />
      </div>
    </div>
    <button id="makeBtn" class="btn">Make 8‑char ID</button>
    <label for="token">Generated ID (copy this)</label>
    <input id="token" class="mono" readonly placeholder="Token appears here…" />
  </div>

  <div class="box" style="margin-top: var(--gap);">
    <label for="tokenIn">Decode existing ID</label>
    <input id="tokenIn" class="mono" placeholder="Paste 8‑char token here…" />
    <button id="decodeBtn" class="btn secondary">Decode</button>
    <div id="out" class="muted" style="margin-top:10px;">No output yet.</div>
  </div>

  <p class="muted">Ranges: Year 0–16383, Month 1–12, Day 1–31, Amount 0–$335,544.31. If you exceed these, you’ll see an error.</p>

  <footer>
    <div>Tip: this is a compact identifier, not encryption. If you need secrecy, use an encrypted token instead.</div>
  </footer>

<script>
  // --- Base64url helpers (no padding) ---
  function b64UrlEncode(bytes) {
    let bin = '';
    for (let b of bytes) bin += String.fromCharCode(b);
    return btoa(bin).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
  }
  function b64UrlDecode(s) {
    s = s.trim().replace(/-/g,'+').replace(/_/g,'/');
    while (s.length % 4) s += '=';
    const bin = atob(s);
    const arr = new Uint8Array(bin.length);
    for (let i=0;i<bin.length;i++) arr[i] = bin.charCodeAt(i);
    return arr;
  }

  // --- Pack YYYY/MM/DD + cents into 48 bits (6 bytes) ---
  function packDateAmount(yyyy, mm, dd, cents) {
    if (!(Number.isInteger(yyyy) && 0 <= yyyy && yyyy <= 16383)) throw new Error("Year out of range (0..16383)");
    if (!(Number.isInteger(mm) && 1 <= mm && mm <= 12)) throw new Error("Month must be 1..12");
    if (!(Number.isInteger(dd) && 1 <= dd && dd <= 31)) throw new Error("Day must be 1..31");
    if (!(Number.isInteger(cents) && 0 <= cents && cents <= ((1<<25)-1))) throw new Error("Amount too large (max 33,554,431 cents)");
    let v = BigInt(yyyy);
    v = (v << 34n) | (BigInt(mm) << 30n) | (BigInt(dd) << 25n) | BigInt(cents); // 14|4|5|25 = 48 bits
    const out = new Uint8Array(6);
    for (let i=5;i>=0;i--) { out[i] = Number(v & 0xFFn); v >>= 8n; }
    return out;
  }
  function unpackDateAmount(bytes6) {
    if (!(bytes6 instanceof Uint8Array) || bytes6.length !== 6) throw new Error("Need 6 bytes");
    let v = 0n;
    for (let i=0;i<6;i++) v = (v << 8n) | BigInt(bytes6[i]);
    const cents = Number(v & ((1n<<25n)-1n)); v >>= 25n;
    const day   = Number(v & ((1n<<5n)-1n));  v >>= 5n;
    const month = Number(v & ((1n<<4n)-1n));  v >>= 4n;
    const year  = Number(v & ((1n<<14n)-1n));
    return {year, month, day, cents};
  }

  // --- UI actions ---
  function parseAmountToCents(s) {
    const m = String(s).trim().match(/^(\d+)(?:\.(\d{1,2}))?$/);
    if (!m) throw new Error("Amount must look like 12 or 12.34");
    const dollars = parseInt(m[1],10);
    const centsPart = m[2] ? m[2].padEnd(2,'0') : '00';
    return dollars*100 + parseInt(centsPart,10);
  }

  document.getElementById('makeBtn').addEventListener('click', () => {
    try {
      const d = document.getElementById('date').value.trim();
      if (!/^\d{8}$/.test(d)) throw new Error("Date must be YYYYMMDD");
      const yyyy = parseInt(d.slice(0,4),10);
      const mm   = parseInt(d.slice(4,6),10);
      const dd   = parseInt(d.slice(6,8),10);
      const cents = parseAmountToCents(document.getElementById('amt').value);
      const b6 = packDateAmount(yyyy, mm, dd, cents);
      const token = b64UrlEncode(b6);
      document.getElementById('token').value = token;
    } catch (e) {
      alert(e.message || String(e));
    }
  });

  document.getElementById('decodeBtn').addEventListener('click', () => {
    const out = document.getElementById('out');
    try {
      const tok = document.getElementById('tokenIn').value.trim();
      const b = b64UrlDecode(tok);
      const {year, month, day, cents} = unpackDateAmount(b);
      const dollars = (cents/100).toFixed(2);
      const y = String(year).padStart(4,'0');
      const m = String(month).padStart(2,'0');
      const d = String(day).padStart(2,'0');
      out.innerHTML = `<span class="ok">Decoded</span><br/>Date: <code>${y}${m}${d}</code><br/>Amount: <code>$${dollars}</code> (<code>${cents}</code> cents)`;
    } catch (e) {
      out.innerHTML = `<span class="err">Error:</span> ${e.message || String(e)}`;
    }
  });
</script>
</body>
</html>
